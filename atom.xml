<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Matt Snider]]></title>
  <link href="http://msnider.github.io/atom.xml" rel="self"/>
  <link href="http://msnider.github.io/"/>
  <updated>2013-12-06T20:40:02-05:00</updated>
  <id>http://msnider.github.io/</id>
  <author>
    <name><![CDATA[Matt Snider]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Force HTTPS/SSL on Amazon Elastic Beanstalk]]></title>
    <link href="http://msnider.github.io/blog/2013/12/06/force-https-slash-ssl-on-amazon-elastic-beanstalk/"/>
    <updated>2013-12-06T20:12:57-05:00</updated>
    <id>http://msnider.github.io/blog/2013/12/06/force-https-slash-ssl-on-amazon-elastic-beanstalk</id>
    <content type="html"><![CDATA[<ol>
<li>Configure Elastic Beanstalk to allow both HTTP &amp; HTTPS. Make sure to set an
 SSL Certicate. This will require a refresh of the Elastic Load Balancer.
 <img src="http://msnider.github.io/images/aws-eb-https-configuration.png">
 Now your application should be accessible by both HTTP and HTTPS.</li>
<li>Every Elastic Beanstalk application uses the Apache web server which can be
 used to redirect non-SSL traffic to the HTTPS endpoint.
 The easiest way to do this is to create a custom configuration file which
 creates the re-write rules.

<ol>
<li>Create (if you don&rsquo;t already have) a &ldquo;.ebextensions&rdquo; directory in the root
 of the deployed directory. So in PHP apps, this is the top level or in
 Java apps this would be src/main/webapp</li>
<li>Create a Apache config file called &ldquo;elasticbeanstalk.conf&rdquo; in .ebextensions</li>
<li><p>I use the following rules in elasticbeanstalk.conf:
         &#8220;` apacheconf elasticbeanstalk.conf
         <VirtualHost *:80>
           <Proxy *>
             Order deny,allow
             Allow from all
           </Proxy></p>

<pre><code>       ProxyPass / http://localhost:8080/ retry=0
       ProxyPassReverse / http://localhost:8080/
       ProxyPreserveHost on

       RewriteEngine On
       RewriteCond %{HTTP:X-Forwarded-Proto} !https
       RewriteRule !/status https://%{SERVER_NAME}%{REQUEST_URI} [L,R]

       LogFormat "%h (%{X-Forwarded-For}i) %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\""
       ErrorLog /var/log/httpd/elasticbeanstalk-error_log
       TransferLog /var/log/httpd/elasticbeanstalk-access_log
     &lt;/VirtualHost&gt;
     ```
</code></pre></li>
<li>Create a .config file in the same directory (i.e. https.config) and add
 the command for moving the .conf file to the correct spot:
         &#8220;` yaml https.config
         container_commands:
           01_replace_apache_server:
             command: cp .ebextensions/elasticbeanstalk.conf /etc/httpd/conf.d/elasticbeanstalk.conf</li>
</ol>
</li>
<li>Deploy your application with the new config files</li>
<li>Restart Apache (or rebuild the environment) to pick up the changes
 To restart Apache run: <code>sudo /etc/init.d/httpd restart</code></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creating a Self-Signed SSL Certificate for an Amazon ELB]]></title>
    <link href="http://msnider.github.io/blog/2013/12/05/creating-a-self-signed-ssl-certificate-for-an-amazon-elb/"/>
    <updated>2013-12-05T00:06:01-05:00</updated>
    <id>http://msnider.github.io/blog/2013/12/05/creating-a-self-signed-ssl-certificate-for-an-amazon-elb</id>
    <content type="html"><![CDATA[<ol>
<li>Generate a Private Key
 The Private Key is used to decrypt messages sent to the server. Keep this
 safe and secret! Use any password when prompted (we&rsquo;ll remove it later).
 <code>openssl genrsa -des3 -out domain.key 1024</code></li>
<li>Generate a Certificate Signing Request (CSR)
 The CSR contains the Public Key, used to encrypt messages, and information
 about the application so the end user (visitor) can see, so enter the
 information accordingly.
 <code>openssl req -nodes -newkey rsa:2048 -keyout domain.key -out domain.csr</code></li>
<li>Remove the Password from the Private Key
 <code>cp domain.key domain.key.password</code>
 <code>openssl rsa -in domain.key.password -out domain.key</code></li>
<li>Generate the Certificate
 Make sure to set the number of days before expiration, set to 1 year below.
 <code>openssl x509 -req -days 365 -in domain.csr -signkey domain.key -out domain.crt</code></li>
<li>Open the AWS Console to upload your certificate

<ol>
<li>Open the AWS Console</li>
<li>Open the EC2 Dashboard then view &ldquo;Load Balancers&rdquo;</li>
<li>Select any load balancer or create a new one (You don&rsquo;t have to assign it to this ELB)</li>
<li>Click on the Listeners tab of the load balancer</li>
<li>Select HTTPS for a new listener and under SSL Certificate click &ldquo;Select&rdquo;</li>
<li>Choose &ldquo;Upload a new SSL Certificate&rdquo; and give it a name</li>
</ol>
</li>
<li>Copy the Private Key to the &ldquo;Private Key&rdquo; field

<ol>
<li>Output the private key to the command line
 <code>openssl rsa -in domain.key -text</code></li>
<li>Copy everything from the &ldquo;Begin&rdquo; to the &ldquo;End&rdquo; tags (inclusive)</li>
</ol>
</li>
<li>Copy the Certificate to the &ldquo;Public Key Certificate&rdquo; field

<ol>
<li>Output the certificate to the command line
 <code>openssl x509 -inform PEM -in domain.crt</code></li>
<li>Copy everything from the &ldquo;Begin&rdquo; to the &ldquo;End&rdquo; tags (inclusive)</li>
</ol>
</li>
<li>Save the SSL Cert in AWS</li>
<li>Assign this certificate to this or another ELB or within Elastic Beanstalk</li>
</ol>


<h3>References</h3>

<ul>
<li><a href="http://almostalldigital.wordpress.com/2013/03/07/self-signed-ssl-certificate-for-ec2-load-balancer/">http://almostalldigital.wordpress.com/2013/03/07/self-signed-ssl-certificate-for-ec2-load-balancer/</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
